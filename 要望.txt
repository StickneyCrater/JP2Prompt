目論見

Open WebUI、ollama, dockerdesktop, wsl2あたりが稼働中。
完全にローカルに閉じた環境、セキュリティや認証は不要。
開発はwin11上、動作はwin11(RTX3080 12G) dockerdesktopか NAS(QNAP TS-231P)を想定。
NASで動作させる場合、ollamaはwin11で動作し、
APIのみNAS上Container-stationで極力軽量なコンテナで動作させる。

日本語の自然言語からForgeで画像生成したい。nsfw込み。
NAS上でFastAPIに実装した　「実装対象API」を動作させる。
・以下が「希望する動作」である
1. 実装対象APIに日本語入力->
2. 実装対象APIがwin11上Ollamaに翻訳のシステムプロンプトとともに日本語入力を投げる->
3. ollamaの（brxce/stable-diffusion-prompt-generator:latest)でdanbooru仕込みの
　　英語プロンプトに変換->
4. 実装対象API内でwin11上のForgeに他のオプション指定とともにプロンプトを投げる->
5. Forgeが生成された画像をBase64で返してくるので実装対象APIはそれをデコードしてNASに保存->
6. 実装対象APIがbase64のままの画像を返す。

これを軽量なコンテナでよわよわCPUのNAS上コンテナで実行したい。

Armv7, Alpine Linux (GCCなし), FastApi, uncone, Pydantic あたりで実装。
ただしPydanticはv2系だとrustが必要になるので、v1系で。他のライブラリもそれに合わせた
バージョンが必要。

添付は現状でPC上で動作してるollamaによる翻訳API。
英語（Automatic1111用プロンプト）に変換させる機能は現状でほぼそのまま利用できる。

ーーーーーーーーーーーーーーーーーーーここまでmain.py実装済

翻訳機能＋Automatic1111APIへのプロキシがつくりたい。
Automatic1111Forgeの　--api オプションで実行した場合のAPI仕様が添付のOpenApi.jsonである。


現状の/translate はそのままに。

新規に/get_image を作成する。
　「希望する動作」を実装。

さらにサポート機能として、
　モデル切り替え
　VAE指定（Forgeでfluxを実行する場合には画面上のVAE / Text Encoder欄からTEとUNETの指定が必須な為）
　画像サイズ指定
　CFGスケール指定
　ステップ数指定
　バッチサイズ指定
　バッチカウント指定
が必要。
できるなら
　Dynamic PromptのOn/Offは指定したい。
これらは毎回は実行しないが、実装対象APIにて中継および現在設定値および過去設定履歴の保持と選択できる
UI(静的index.html)が欲しい。

get / で設定用heml (上記設定項目とプロンプト、ネガティブプロンプト入力欄）
（現状の　/ はサンプルなのでつぶしてよい）





要望２
あなたは優秀で顧客の要望に忠実に答えようとする開発者です。以下の要望に対応して。

添付のmain.pyは日本語文字列入力を受け付けてAutomatic1111 forgeで画像を生成するAPIおよび簡易WebIFです。
現在問題なく動いているので、動いている部分は壊したくないです。
それを前提に、以下を変更したい。

①APIの　"/"で表示されるWebIF画面で、「Generate Image」ボタンを押下した際に、
　画像表示領域（以前に複数枚を表示していた場合は１件にシュリンクする）に
　ソースと同じフォルダにあるanimated.gifという名称の固定ファイルを表示したい。生成完了で現行と同様に
　生成結果画像を表示する。
②生成がエラーになったら　ソースと同じフォルダにあるerr.gifという名称の固定ファイルを表示する。
③WebIF画面およびAP生成Automatic1111 Forgeの以下を設定できるようにしたい。
現在のmain.pyで画像生成MODELについてForge側からの設定習得やこちらでの選択、永続化、Forgeへの反映が
実装済なので同様の挙動を期待している。
Automatic1111 Forge側APIについては添付openAPI.json参照。
　1.TextEncorder
　2.UNET
　3.VAE
 (以上の3点がForge上でFLuxを実行する為に必要となる為)
④LLMに利用させる為、Automatic1111ForgeのAPI(添付のopenapi.json)のProxy wrapperを作成してほしい。
　現状のAPIではhttp://192.168.2.199:8091/ 以下を使っている。
　それに対して、　http://192.168.2.199:8091/sd/ 以下にて添付openAPI/jsonの全APIを実行できるようにしたい。
　また、wrapperではdescriptionもLLMがツールとして使えるように整備したい。
　wrapperでは入力を何も変換せず、データを保持せず、純粋に既存の日本語画像生成APIと同じFORGEに中継だけをさせたい。
　
上記①②③④をmain.appに実装してほしい、画像ファイルはこちらで準備するので不要。
requireやビルドオプション等はもし変更点があれば示してほしい。
だが、基本的にpythonのみのコーディングのみなので不要と想定している。
